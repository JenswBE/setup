- name: Install, configure, and enable UFW
  become: true
  tags: ["setup", "firewall"]
  block:
    - name: UFW - Ensure is installed
      ansible.builtin.package: name=ufw state=present

    - name: UFW - Clear current firewall rules
      community.general.ufw:
        state: reset

    - name: UFW - Allow SSH
      community.general.ufw:
        rule: allow
        port: "{{ firewall_ssh_port | string }}"
        proto: tcp

    - name: UFW - Allow additional ports
      community.general.ufw:
        rule: allow
        port: "{{ item.port | string }}"
        proto: "{{ item.proto }}"
        from_ip: "{{ item.from_ip }}"
      with_items: "{{ firewall_additional_ports }}"

    - name: UFW - Enable firewall
      community.general.ufw:
        state: enabled
