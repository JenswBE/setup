- name: Setup server
  hosts: all
  vars:
    playbook_name: vm_host
    playbook_supported_distros:
      - Rocky

  pre_tasks:
    - name: Include init tasks
      ansible.builtin.include_tasks: "tasks/init.yml"
      tags: ["always"]

  roles:
    - role: geerlingguy.security
      become: true

    - role: jenswbe.vm_host

    - role: jenswbe.nbde_server
      tags: ["nbde", "nbde_server"]

    - role: jenswbe.nbde_client
      tags: ["nbde", "nbde_client"]

    # Firewall config relies on services installed by earlier roles
    - role: jenswbe.firewall
      tags: ["firewall"]
