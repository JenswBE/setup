http:
  middlewares:
    transmission-set-host:
      headers:
        customRequestHeaders:
          Host: "transmission"
    transmission-system-auth:
      basicAuth:
        users:
          - "{{ app_transmission_system_users }}"

  routers:
    # For users
    transmission:
      entryPoints: ["websecure"]
      rule: "Host(`torrent.{{ general_domain_default }}`)"
      service: transmission
      tls:
        certresolver: le-tls
      middlewares:
        - oauth2-proxy-handle-error
        - oauth2-proxy-forward-auth-infra
        - transmission-set-host

    # For healthchecks and other integrations
    transmission-system:
      entryPoints: ["websecure"]
      rule: "Host(`torrent-system.{{ general_domain_default }}`)"
      service: transmission
      tls:
        certresolver: le-tls
      middlewares:
        - transmission-system-auth
        - transmission-set-host

  services:
    transmission:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8100/"
