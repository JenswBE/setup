# This file contains all services generated by Ansible
# as they are marked as invalid by the JSON schema check
# for Docker Compose.

#VAR:lookup('ansible.builtin.file', 'files/docker-compose.default.yml',):VAR#

#################################################################
#                            SERVICES                           #
#################################################################
services:
# Ensure to add DNS entry before bumping!
#BLOCK:for year in range(2019,2023+1):BLOCK#
  "nginx-tuinfeest-archive-#VAR:year:VAR#":
    <<: *defaults
    image: docker.io/nginxinc/nginx-unprivileged:alpine
    container_name: "nginx-tf-archive-#VAR:year:VAR#"
    user: "#VAR:ansible_real_user_id:VAR#"
    networks:
      - traefik
    environment:
      TZ: "#VAR:general_timezone:VAR#"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.nginx-tuinfeest-archive-#VAR:year:VAR#.entrypoints=websecure"
      - "traefik.http.routers.nginx-tuinfeest-archive-#VAR:year:VAR#.rule=Host(`#VAR:year:VAR#.#VAR:general_domain_tuinfeest:VAR#`)"
      - "traefik.http.routers.nginx-tuinfeest-archive-#VAR:year:VAR#.tls.certresolver=le-tls"
      - "traefik.http.services.nginx-tuinfeest-archive-#VAR:year:VAR#-#VAR:ansible_hostname:VAR#.loadbalancer.server.port=8080"
    volumes:
#BLOCK:if year == 2021:BLOCK#
      - "./nginx/tf-2021-redirect/nginx.conf:/etc/nginx/conf.d/default.conf:ro"
#BLOCK:else:BLOCK#
      - "#VAR:general_path_appdata:VAR#/nginx/tuinfeest-archive/#VAR:year:VAR#:/usr/share/nginx/html:ro"
#BLOCK:endif:BLOCK#
#BLOCK:endfor:BLOCK#
