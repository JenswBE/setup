http:
  routers:
    bjoetiek-frontend:
      entryPoints: ["websecure"]
      tls: { certresolver: le-tls }
      rule: Host(`{{ general_domain_bjoetiek }}`)
      service: bjoetiek-frontend

    bjoetiek-backend:
      entryPoints: ["websecure"]
      tls: { certresolver: le-tls }
      rule: >-
        (
        Host(`backend.{{ general_domain_bjoetiek }}`) ||
        Host(`beheer.{{ general_domain_bjoetiek }}`)
        ) && !PathPrefix(`/images`)
      service: bjoetiek-backend
      middlewares:
        - bjoetiek-cors

    bjoetiek-imgproxy:
      entryPoints: ["websecure"]
      tls: { certresolver: le-tls }
      rule: "Host(`backend.{{ general_domain_bjoetiek }}`) && PathPrefix(`/images`)"
      service: bjoetiek-imgproxy
      middlewares:
        - strip-images-prefix

  services:
    bjoetiek-frontend:
      loadBalancer:
        servers: [{ url: "http://bjoetiek-frontend:8080" }]

    bjoetiek-backend:
      loadBalancer:
        servers: [{ url: "http://bjoetiek-backend:8080" }]

    bjoetiek-imgproxy:
      loadBalancer:
        servers: [{ url: "http://bjoetiek-imgproxy:8080" }]
