version: "3.7"

#################################################################
#                            DEFAULTS                           #
#################################################################
x-defaults: &defaults
  restart: always
  extra_hosts:
    - "host.docker.internal:host-gateway"
  logging:
    driver: syslog
    options:
      tag: "{{ 'docker-{{.Name}}' }}"

#################################################################
#                            SERVICES                           #
#################################################################
services:
  # =========================
  # =    Cloudflare DDNS    =
  # =========================
  cloudflare-ddns:
    <<: *defaults
    image: oznu/cloudflare-ddns:latest
    container_name: cloudflare-ddns
    environment:
      - "TZ={{ general_timezone }}"
      - "EMAIL={{ app_cloudflare_email }}"
      - "API_KEY={{ app_cloudflare_api_key }}"
      - "ZONE={{ app_cloudflare_zone }}"
      - "SUBDOMAIN={{ app_cloudflare_subdomain }}"
    dns:
      - "1.1.1.1"
      - "1.0.0.1"

  # =========================
  # =     AUTO-UPDATER      =
  # =========================
  watchtower:
    <<: *defaults
    image: containrrr/watchtower:latest
    container_name: watchtower
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    command: --schedule "0 0 4 * * *" --cleanup
    environment:
      - "TZ={{ general_timezone }}"
